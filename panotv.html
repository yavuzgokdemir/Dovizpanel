<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Dashboard Engine v3.5 - Elite Edition</title>
    <meta name="theme-color" content="#000000">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;600;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #007bff; --success: #00c853; --danger: #ff5252;
            --glass: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1);
            --gold: #FFD700; --gold-bright: #FFE44D;
            --fx-up: #00ff66; --fx-down: #ff3333;
            --eko-red: #c61118; --eko-green: #118c4f; --eko-turkuaz: #0087b3;
            --eko-dark: #121516; --eko-gray: #2d2f30;
            --tv-safe-padding: 4vh; 
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; color: #fff; font-family: 'Inter', sans-serif;
            overflow: hidden; font-size: 1.1vw;
        }

        .engine-container { height: 100%; width: 100%; position: relative; z-index: 1; box-sizing: border-box; }
        #bg-canvas, #gold-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        
        /* --- MOD 1: EKOTÜRK ÖZEL STİLLERİ --- */
        .eko-wrapper { position: relative; width: 100%; height: 100%; overflow: hidden; }
        .eko-video-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .eko-video-bg video { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        
        .eko-headline-layer { position: absolute; bottom: 134px; width: 100%; height: 60px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px); overflow: hidden; border-top: 2px solid rgba(255,255,255,0.1); }
        #headlineStack { display: flex; flex-direction: column; transition: transform 0.8s cubic-bezier(0.65, 0, 0.35, 1); }
        .headline-item { min-height: 60px; height: 60px; display: flex; align-items: center; padding-left: 30px; color: white; font-size: 1.6rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .eko-stock-layer { position: absolute; bottom: 102px; width: 100%; height: 32px; background: var(--eko-gray); display: flex; align-items: center; overflow: hidden; }
        .stock-ticker { display: flex; animation: scrollTicker 60s linear infinite; }
        .stock-item { padding: 0 30px; display: flex; align-items: center; gap: 10px; font-weight: bold; font-size: 0.9rem; color: #ddd; border-right: 1px solid #555; white-space: nowrap; }
        
        .eko-currency-layer { position: absolute; bottom: 32px; width: calc(100% - 140px); height: 70px; background: var(--eko-dark); display: flex; }
        .eko-curr-box { flex: 1; border-right: 1px solid rgba(255,255,255,0.1); padding: 10px; display: flex; flex-direction: column; }
        .eko-curr-name { font-size: 0.75rem; color: rgba(255,255,255,0.7); font-weight: bold; margin-bottom: 5px; }
        .eko-flip-container { height: 35px; overflow: hidden; position: relative; }
        .eko-flip-inner { position: absolute; width: 100%; transition: transform 0.8s ease-in-out; }
        .eko-flip-row { height: 35px; display: flex; align-items: center; justify-content: space-between; color: white; font-size: 1.4rem; font-weight: 700; }
        
        .eko-side-panel { position: absolute; right: 0; bottom: 32px; width: 140px; height: 132px; background: #004d66; border-left: 1px solid rgba(255,255,255,0.2); display: flex; flex-direction: column; align-items: center; justify-content: space-around; }
        .eko-logo-area { font-weight: 900; color: white; font-size: 1.1rem; text-align: center; line-height: 1; }
        .eko-logo-area span { display: block; font-size: 0.5rem; font-weight: normal; letter-spacing: 1px; margin-top: 4px; }
        .eko-info-layer { position: absolute; bottom: 0; width: 100%; height: 32px; background: var(--eko-turkuaz); display: flex; align-items: center; color: white; font-weight: bold; padding: 0 20px; }

        @keyframes scrollTicker { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* STANDBY CARD */
        .main-card { position: relative; z-index: 2; padding: 4rem; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(40px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 80px; text-align: center; max-width: 850px; width: 85%; margin: auto; animation: cardEntrance 1.5s ease-out; }
        #clock-standby { font-size: 11rem; font-weight: 200; letter-spacing: -8px; line-height: 1; }
        @keyframes cardEntrance { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<canvas id="bg-canvas"></canvas>
<canvas id="gold-canvas" style="display:none;"></canvas>
<div id="dashboard-engine" class="engine-container"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCfcppc4rGYxmAj7fTzmYMZgcyBO4s8bFI",
        databaseURL: "https://doviz-kurlari-35554-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "doviz-kurlari-35554",
        appId: "1:822410580056:web:40d02d7729d7cf72aafa2d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentConfig = { master: null, screen: null };
    let activeIntervals = [];
    let newsList = [];
    let currentNewsIndex = 0;
    let flipState = false;

    // Motor Temizleyici: Modlar arası geçişte her şeyi durdurur
    function clearEngine() {
        activeIntervals.forEach(clearInterval);
        activeIntervals = [];
        document.getElementById('bg-canvas').style.display = "none";
        document.getElementById('gold-canvas').style.display = "none";
        const container = document.getElementById('dashboard-engine');
        container.innerHTML = "";
    }

    db.ref('terminal_data').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
        const master = data.tv_settings?.master || false;
        const screen = data.tv_settings?.screen || "1";

        if (currentConfig.master !== master || currentConfig.screen !== screen) {
            currentConfig.master = master;
            currentConfig.screen = screen;
            updateUI();
        }
    });

    function updateUI() {
        const container = document.getElementById('dashboard-engine');
        clearEngine();

        if (!currentConfig.master) renderStandby(container);
        else if (currentConfig.screen === "1") renderMod1(container); 
        else if (currentConfig.screen === "4") renderMod4(container);
        else if (currentConfig.screen === "5") renderMod5(container);
        else if (currentConfig.screen === "6") renderMod6(container);
        else renderGeneric(container, currentConfig.screen);
    }

    // --- MOD 1: EKOTÜRK ENGINE ---
    async function renderMod1(container) {
        container.innerHTML = `
            <div class="eko-wrapper">
                <div class="eko-video-bg"><video autoplay muted loop playsinline><source src="video1.mp4" type="video/mp4"></video></div>
                <div class="eko-side-panel">
                    <div class="eko-logo-area">EKOTÜRK <span>TÜRKİYE'NİN EKONOMİ TELEVİZYONU</span></div>
                    <div style="text-align:center; color:white;">
                        <div id="eko-clock" style="font-size:1.4rem; font-weight:bold;">00:00</div>
                        <div id="eko-date" style="font-size:0.7rem; opacity:0.8;">---</div>
                    </div>
                </div>
                <div class="eko-headline-layer"><div id="headlineStack"><div class="headline-item">HABERLER YÜKLENİYOR...</div></div></div>
                <div class="eko-stock-layer"><div class="stock-ticker" id="stockTicker"></div></div>
                <div class="eko-currency-layer" id="ekoCurrencyGrid"></div>
                <div class="eko-info-layer"><marquee scrollamount="6" id="bottomNews">Veriler güncelleniyor...</marquee></div>
            </div>`;

        // RSS Haber ve Borsa Simülasyonu
        const updateExternalData = async () => {
            try {
                const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://www.aa.com.tr/tr/rss/default?cat=ekonomi`);
                const data = await res.json();
                if(data.items) {
                    newsList = data.items.map(i => i.title.toUpperCase());
                    const stack = document.getElementById('headlineStack');
                    if(stack) stack.innerHTML = newsList.map(t => `<div class="headline-item">${t}</div>`).join('');
                    const bNews = document.getElementById('bottomNews');
                    if(bNews) bNews.innerText = newsList.join(" +++ ");
                }
                // Global Borsa Bandı
                const stocks = [{n:"BIST 100", v:"9.120", c:"+1.2"}, {n:"DOLAR", v:"32.45", c:"+0.05"}, {n:"EURO", v:"35.12", c:"-0.12"}, {n:"S&P 500", v:"5.137", c:"+0.8"}, {n:"DAX", v:"17.735", c:"-0.1"}];
                const ticker = document.getElementById('stockTicker');
                if(ticker) ticker.innerHTML = [...stocks, ...stocks].map(s => `
                    <div class="stock-item">${s.n} <span style="color:white">${s.v}</span> <span style="color:${s.c.includes('-')?'#ff4d4d':'#00ff88'}">${s.c}%</span></div>
                `).join('');
            } catch(e) { console.error("Data error"); }
        };
        updateExternalData();
        activeIntervals.push(setInterval(updateExternalData, 300000));

        // Saat ve Haber Kaydırma
        activeIntervals.push(setInterval(() => {
            const now = new Date();
            const clockEl = document.getElementById('eko-clock');
            const dateEl = document.getElementById('eko-date');
            if(clockEl) clockEl.innerText = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
            if(dateEl) dateEl.innerText = now.toLocaleDateString('tr-TR', {day:'2-digit', month:'long'}).toUpperCase();
            
            if(newsList.length > 0) {
                currentNewsIndex = (currentNewsIndex + 1) % newsList.length;
                const stack = document.getElementById('headlineStack');
                if(stack) stack.style.transform = `translateY(-${currentNewsIndex * 60}px)`;
            }
        }, 8000));

        // Flip Animasyonu (Alış/Satış değişimi)
        activeIntervals.push(setInterval(() => {
            flipState = !flipState;
            document.querySelectorAll('.eko-flip-inner').forEach(el => el.style.transform = flipState ? 'translateY(-35px)' : 'translateY(0px)');
        }, 5000));

        // Firebase Döviz Verisi (Canlı)
        db.ref('terminal_data/currencies').on('value', snap => {
            if(currentConfig.screen !== "1") return;
            const data = Object.values(snap.val() || {}).slice(0, 5);
            const grid = document.getElementById('ekoCurrencyGrid');
            if(grid) {
                grid.innerHTML = data.map((item, i) => `
                    <div class="eko-curr-box" style="background: rgba(0, 80, 110, ${0.3 + (i*0.1)})">
                        <div class="eko-curr-name">${item.name}</div>
                        <div class="eko-flip-container">
                            <div class="eko-flip-inner">
                                <div class="eko-flip-row"><span>${parseFloat(item.buy).toFixed(3)}</span><small style="color:#00ff88">▲</small></div>
                                <div class="eko-flip-row"><span>${parseFloat(item.sell).toFixed(3)}</span><small style="color:#00ff88">▲</small></div>
                            </div>
                        </div>
                    </div>`).join('');
            }
        });
    }

    // --- DİĞER MEVCUT MODLAR ---
    function renderStandby(container) {
        const canvas = document.getElementById('bg-canvas');
        canvas.style.display = "block";
        container.innerHTML = `
            <div class="main-card">
                <div id="greeting" style="font-weight: 900; letter-spacing: 12px; color: var(--primary); font-size: 1.8rem; margin-bottom: 20px;">HOŞGELDİNİZ</div>
                <div id="clock-standby">00:00</div>
                <div id="full-date" style="font-size: 1.6rem; color: rgba(255,255,255,0.5); text-transform: uppercase;">---</div>
            </div>`;
        initModernCanvas(canvas);
        const ticker = () => {
            const now = new Date();
            const c = document.getElementById('clock-standby');
            if(c) c.textContent = now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0');
            const d = document.getElementById('full-date');
            if(d) d.textContent = now.toLocaleDateString('tr-TR', {day:'numeric', month:'long', year:'numeric', weekday:'long'});
        }; 
        ticker(); 
        activeIntervals.push(setInterval(ticker, 1000));
    }

    function renderMod4(container) { /* Eski Mod 4 kodunuz buraya */ container.innerHTML = "<h1>MOD 4 YÜKLENDİ</h1>"; }
    function renderMod5(container) { /* Eski Mod 5 kodunuz buraya */ container.innerHTML = "<h1>MOD 5 YÜKLENDİ</h1>"; }
    function renderMod6(container) { /* Eski Mod 6 kodunuz buraya */ container.innerHTML = "<h1>MOD 6 YÜKLENDİ</h1>"; }
    function renderGeneric(container, id) { container.innerHTML = `<h1 style="text-align:center; padding-top:20vh;">MOD ${id} HENÜZ TASARLANMADI</h1>`; }

    // Canvas Fonksiyonları
    function initModernCanvas(c) {
        const ctx = c.getContext('2d'); let p = []; c.width = window.innerWidth; c.height = window.innerHeight;
        for(let i=0; i<50; i++) p.push({x:Math.random()*c.width, y:Math.random()*c.height, vx:(Math.random()-0.5)*0.5, vy:(Math.random()-0.5)*0.5});
        const anim = () => {
            if(currentConfig.master) return;
            ctx.clearRect(0,0,c.width,c.height);
            p.forEach(i => {
                i.x += i.vx; i.y += i.vy;
                if(i.x<0 || i.x>c.width) i.vx*=-1; if(i.y<0 || i.y>c.height) i.vy*=-1;
                ctx.beginPath(); ctx.arc(i.x, i.y, 2, 0, Math.PI*2); ctx.fillStyle="rgba(0,123,255,0.5)"; ctx.fill();
            });
            requestAnimationFrame(anim);
        }; anim();
    }

    window.addEventListener('resize', () => {
        const c1 = document.getElementById('bg-canvas');
        if(c1) { c1.width = window.innerWidth; c1.height = window.innerHeight; }
    });
</script>
</body>
</html>
