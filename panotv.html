<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise TV Terminal v3.2</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">

    <style>
        :root {
            --eko-red: #c61118; --eko-green: #118c4f; --eko-turkuaz: #0087b3; --eko-dark: #121516;
            --cnbc-green: #008f39; --cnbc-red: #c40000; --cnbc-dark: #000b1a;
            --gold: #FFD700; --buy-red: #FF3B30; --sell-green: #4CD964; --eko-gray: #2d2f30;
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; }
        
        /* STANDBY EKRANI */
        #standby-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); text-align: center; }
        .welcome-title { font-size: 4rem; font-weight: 900; letter-spacing: 5px; margin-bottom: 20px; animation: pulse 3s infinite; }
        .welcome-time { font-family: 'JetBrains Mono', monospace; font-size: 3rem; color: var(--eko-turkuaz); }
        
        @keyframes pulse { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }

        #tv-container { display: none; width: 100%; height: 100%; position: relative; }
        .video-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; object-fit: cover; }
        
        /* MOD 1 & 2: EKOTÜRK TASARIMI */
        .eko-layout .layer-headline { position: absolute; bottom: 134px; width: 100%; height: 60px; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); display: flex; align-items: center; padding-left: 30px; border-top: 2px solid rgba(255,255,255,0.1); }
        .eko-layout .layer-stocks { position: absolute; bottom: 102px; width: 100%; height: 32px; background: var(--eko-gray); display: flex; align-items: center; overflow: hidden; border-bottom: 1px solid #444; }
        .eko-layout .layer-currency { position: absolute; bottom: 32px; width: calc(100% - 140px); height: 70px; background: var(--eko-dark); display: flex; }
        .eko-layout .side-panel { position: absolute; right: 0; bottom: 32px; width: 140px; height: 132px; background: #004d66; display: flex; flex-direction: column; align-items: center; justify-content: space-around; }
        .eko-layout .currency-box { flex: 1; border-right: 1px solid #333; padding: 10px; display: flex; flex-direction: column; }
        .eko-layout .flip-container { height: 35px; overflow: hidden; position: relative; }
        .eko-layout .flip-inner { position: absolute; width: 100%; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .eko-layout .flip-row { height: 35px; display: flex; align-items: center; justify-content: space-between; color: white; font-size: 1.4rem; font-weight: 700; }
        
        /* MOD 4: GENEL PANO */
        .genel-layout { padding: 5vh; display: flex; flex-direction: column; gap: 30px; }
        .genel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .genel-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--eko-turkuaz); }

        /* MOD 5: LUXURY GOLD */
        .gold-ui { padding: 2vh 4vw; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); height: 100vh; display: flex; flex-direction: column; }
        .gold-header { text-align: center; color: var(--gold); font-size: 3.5vw; font-weight: 900; letter-spacing: 1vw; margin-bottom: 2vh; }
        .gold-row { display: grid; grid-template-columns: 80px 2fr 1fr 0.5fr 1fr; align-items: center; background: rgba(255, 215, 0, 0.03); margin-bottom: 1.2vh; padding: 1.5vh 2vw; border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.1); }

        /* ORTAK ANİMASYONLAR */
        .marquee-track { display: flex; animation: scroll-left 40s linear infinite; white-space: nowrap; }
        @keyframes scroll-left { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        .up-trend { background: rgba(17, 140, 79, 0.25); color: #00ff88; }
        .down-trend { background: rgba(198, 17, 24, 0.25); color: #ff4d4d; }
    </style>
</head>
<body>

<div id="standby-screen">
    <div class="welcome-title">HOŞGELDİNİZ</div>
    <div class="welcome-time" id="st-time">00:00</div>
    <div class="welcome-date" id="st-date">-- -- ----</div>
</div>

<div id="tv-container">
    <video id="tv-video-bg" class="video-bg" autoplay muted loop></video>
    <div id="dynamic-content"></div>
    <div id="footer-layer"></div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCfcppc4rGYxmAj7fTzmYMZgcyBO4s8bFI",
      databaseURL: "https://doviz-kurlari-35554-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "doviz-kurlari-35554",
      appId: "1:822410580056:web:40d02d7729d7cf72aafa2d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentCurrencies = [];
    let currentSettings = { master: false, screen: "1" };
    let flipState = false;

    db.ref('terminal_data/tv_settings').on('value', snap => {
        currentSettings = snap.val() || { master: false, screen: "1" };
        handleScreenState();
    });

    db.ref('terminal_data/currencies').on('value', snap => {
        const data = snap.val();
        currentCurrencies = data ? Object.values(data) : [];
        if(currentSettings.master) renderSelectedLayout();
    });

    function handleScreenState() {
        const standby = document.getElementById('standby-screen');
        const tv = document.getElementById('tv-container');
        if (currentSettings.master) {
            standby.style.display = 'none';
            tv.style.display = 'block';
            renderSelectedLayout();
        } else {
            standby.style.display = 'flex';
            tv.style.display = 'none';
        }
    }

    function renderSelectedLayout() {
        const container = document.getElementById('dynamic-content');
        const footer = document.getElementById('footer-layer');
        const tvMain = document.getElementById('tv-container');
        const video = document.getElementById('tv-video-bg');
        const screenId = currentSettings.screen;

        tvMain.className = ""; footer.innerHTML = "";

        if (screenId === "1") { // YENİ EKOTÜRK MODU (MOD 1)
            tvMain.classList.add("eko-layout");
            video.src = "video1.mp4";
            container.innerHTML = `
                <div class="side-panel">
                    <div style="font-weight:900; color:white; font-size:1.2rem; text-align:center">EKOTÜRK <span>TV</span></div>
                    <div style="text-align:center; color:white;">
                        <div id="liveTime" style="font-size:1.4rem; font-weight:bold">00:00</div>
                        <div id="st-date" style="font-size:0.7rem; opacity:0.8">-- --</div>
                    </div>
                </div>
                <div class="layer-headline"><div style="color:white; font-size:1.8rem;">TCMB: Para politikasındaki sıkı duruş devam edecek</div></div>
                <div class="layer-stocks"><div class="marquee-track">${generateStockTicker()}</div></div>
                <div class="layer-currency">${generateFlipGrid()}</div>
                <div style="position:absolute; bottom:0; width:100%; height:32px; background:var(--eko-turkuaz); display:flex; align-items:center;">
                    <marquee style="color:white; font-weight:bold;">CANLI: Piyasalar yeni güne pozitif başladı... Dolar endeksi yatay seyrediyor...</marquee>
                </div>
            `;
        } else if (screenId === "4") { // GENEL PANO
            tvMain.classList.add("genel-layout");
            container.innerHTML = `<h1 style="text-align:center; color:var(--gold)">CANLI DÖVİZ TAKİP</h1><div class="genel-grid">${generateGenelGrid()}</div>`;
        } else if (screenId === "5") { // LUXURY GOLD
            tvMain.classList.add("gold-ui");
            const goldItems = currentCurrencies.filter(c => c.category === 'altin' || c.flag === 'gold');
            container.innerHTML = `
                <div class="gold-header">GÜNCEL ALTIN PİYASASI</div>
                ${goldItems.map(c => `
                    <div class="gold-row">
                        <span class="material-icons-outlined" style="color:var(--gold); font-size:3vw">payments</span>
                        <span style="font-size:2.2vw; font-weight:900;">${c.name}</span>
                        <div style="text-align:right"><span style="font-size:0.7vw; color:var(--gold);">ALIŞ</span><br><span style="font-family:'JetBrains Mono'; font-size:3vw; color:var(--buy-red)">${parseFloat(c.buy).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</span></div>
                        <div style="text-align:center; font-size:2.5vw; color:#00ff88">▲</div>
                        <div style="text-align:right"><span style="font-size:0.7vw; color:var(--gold);">SATIŞ</span><br><span style="font-family:'JetBrains Mono'; font-size:3vw; color:var(--sell-green)">${parseFloat(c.sell).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</span></div>
                    </div>
                `).join('')}
            `;
        }
    }

    function generateFlipGrid() {
        return currentCurrencies.slice(0, 5).map(item => `
            <div class="currency-box ${Math.random() > 0.5 ? 'up-trend' : 'down-trend'}">
                <div style="font-size:0.75rem; color:#aaa; font-weight:bold; margin-bottom:5px;">${item.name}</div>
                <div class="flip-container">
                    <div class="flip-inner curr-flip" style="transform: translateY(${flipState ? '-35px' : '0px'})">
                        <div class="flip-row"><span>${parseFloat(item.buy).toFixed(4)}</span> <small style="font-size:0.7rem; background:rgba(0,0,0,0.3); padding:2px 5px; border-radius:3px;">ALIŞ</small></div>
                        <div class="flip-row"><span>${parseFloat(item.sell).toFixed(4)}</span> <small style="font-size:0.7rem; background:rgba(0,0,0,0.3); padding:2px 5px; border-radius:3px;">SATIŞ</small></div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function generateStockTicker() {
        const fakeStocks = [{n:"EGEEN", v:"14.485"}, {n:"GARAN", v:"89.10"}, {n:"THYAO", v:"312.5"}];
        return [...fakeStocks, ...fakeStocks].map(s => `<div style="padding:0 25px; font-weight:bold; color:#ddd; border-right:1px solid #555;">${s.n} <span style="color:white">${s.v}</span> <span style="color:#00ff88">▲</span></div>`).join('');
    }

    function generateGenelGrid() {
        return currentCurrencies.map(c => `<div class="genel-card"><div>${c.name}</div><div style="text-align:right; color:var(--sell-green); font-size:1.5rem;">${parseFloat(c.sell).toFixed(3)}</div></div>`).join('');
    }

    // Flip Animasyonu Döngüsü
    setInterval(() => {
        flipState = !flipState;
        document.querySelectorAll('.curr-flip').forEach(el => {
            el.style.transform = flipState ? 'translateY(-35px)' : 'translateY(0px)';
        });
    }, 4000);

    setInterval(() => {
        const now = new Date();
        const tStr = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        const dStr = now.toLocaleDateString('tr-TR', { day: '2-digit', month: 'long' }).toUpperCase();
        if (document.getElementById('liveTime')) document.getElementById('liveTime').innerText = tStr;
        if (document.getElementById('st-time')) document.getElementById('st-time').innerText = tStr;
        if (document.getElementById('st-date')) document.getElementById('st-date').innerText = dStr;
    }, 1000);
</script>
</body>
</html>
