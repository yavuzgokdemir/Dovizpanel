<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/CNBC_logo.svg/1200px-CNBC_logo.svg.png">
    
    <link rel="manifest" href='data:application/json,{"name":"Enterprise TV","short_name":"EntTV","start_url":".","display":"fullscreen","background_color":"#000000","theme_color":"#000000","icons":[{"src":"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/CNBC_logo.svg/192px-CNBC_logo.svg.png","sizes":"192x192","type":"image/png"},{"src":"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/CNBC_logo.svg/512px-CNBC_logo.svg.png","sizes":"512x512","type":"image/png"}]}'>

    <title>Enterprise TV Terminal v4.2 - PWA Edition</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --cnbc-green: #008f39; --cnbc-red: #c40000; --cnbc-blue: #004a99;
            --panel-dark: rgba(0, 11, 26, 0.85); --bg-dark: #000000;
            --gold-color: #ffd700; --font-main: 'Inter', sans-serif;
        }

        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: #000; color: #fff; font-family: var(--font-main); }

        /* --- MOD 1: KARŞILAMA --- */
        #mod1-container { 
            display: none; width: 100%; height: 100%; flex-direction: column; 
            align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
        }
        .welcome-msg { font-size: 7vw; font-weight: 900; text-transform: uppercase; letter-spacing: -2px; }

        /* --- MEDYA KATMANLARI (1-4 & Standby) --- */
        .media-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none; }
        .active { display: block; }

        /* --- MOD 5: PRO-FX --- */
        #mod5-container { display: none; width: 100%; height: 100%; padding: 2vh 2vw; z-index: 10; position: relative; }
        .snowflake { position: absolute; background: var(--gold-color); border-radius: 50%; opacity: 0.6; animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translateY(-10vh); } 100% { transform: translateY(110vh); } }

        /* --- MOD 6: CNBC-e (İYİLEŞTİRİLMİŞ ENTEGRASYON) --- */
        #mod6-container { display: none; width: 100%; height: 100%; position: relative; z-index: 20; }
        .video-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .video-wrapper video { width: 100%; height: 100%; object-fit: cover; }

        .branding-panel {
            position: absolute; bottom: 133px; left: 0; background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px; display: flex; align-items: center; gap: 15px; border-top-right-radius: 5px; z-index: 100;
        }
        .logo-img { height: 38px; }
        .clock-box { border-left: 2px solid #ccc; padding-left: 15px; font-weight: 900; font-size: 1.4rem; color: #333; }

        .ticker-container { position: absolute; bottom: 0; width: 100%; display: flex; flex-direction: column; z-index: 110; }
        
        .layer-indices { height: 38px; background: rgba(255,255,255,0.98); display: flex; align-items: center; overflow: hidden; color: #000; }
        .track-indices { display: flex; animation: scroll-ticker 15s linear infinite; }
        .index-item { padding: 0 30px; white-space: nowrap; font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; border-right: 1px solid #eee; }
        .idx-badge { padding: 2px 8px; border-radius: 3px; color: white; font-size: 0.85rem; font-weight: 900; }

        .layer-currencies { height: 68px; background: var(--panel-dark); backdrop-filter: blur(10px); display: flex; overflow: hidden; }
        .currency-card { flex: 1; min-width: 185px; height: 68px; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.15); overflow: hidden; }
        
        .cur-row-wrapper { display: flex; flex-direction: column; animation: slide-up-data 6s cubic-bezier(0.85, 0, 0.15, 1) infinite; }
        .cur-data-row { height: 68px; display: flex; flex-direction: column; justify-content: center; padding: 0 20px; color: white; }
        .cur-price { font-size: 1.7rem; font-weight: 900; letter-spacing: -1px; }

        .layer-news { height: 34px; background: #ffffff; display: flex; align-items: center; border-top: 1px solid #ddd; position: relative; overflow: hidden; color: #000; }
        .news-label { background: var(--cnbc-blue); color: white; padding: 0 18px; height: 100%; display: flex; align-items: center; font-weight: bold; font-size: 0.9rem; z-index: 120; position: absolute; left: 0; }
        .news-track { display: flex; white-space: nowrap; animation: news-scroll 25s linear infinite; padding-left: 130px; }
        .news-item { font-weight: bold; font-size: 1.1rem; padding-right: 60px; }

        /* --- ANIMASYONLAR --- */
        @keyframes scroll-ticker { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        @keyframes news-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        @keyframes slide-up-data { 0%, 45% { transform: translateY(0); } 50%, 95% { transform: translateY(-68px); } 100% { transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        
        .status-icon { font-size: 1.2rem; animation: pulse 1s infinite; }
        .icon-up { color: #00ff66; } .icon-down { color: #ff3333; }
        .card-USD { background: rgba(0, 51, 102, 0.5); } .card-EUR { background: rgba(0, 77, 64, 0.5); }
    </style>
</head>
<body>

    <div id="mod1-container">
        <div id="greeting-text" class="welcome-msg">HOŞGELDİNİZ</div>
        <div id="mod1-time" style="font-size: 5vw; opacity: 0.6; font-family: 'JetBrains Mono'; margin-top: 2vh;">00:00</div>
    </div>

    <img id="tv-image" class="media-content">
    <video id="tv-video" class="media-content" autoplay loop muted playsinline><source id="video-source" src="" type="video/mp4"></video>

    <div id="mod5-container">
        <div id="snow-container"></div>
        <div id="mod5-top" style="display:flex; gap:2vw; height:46vh; margin-bottom:2vh;"></div>
        <div id="mod5-bottom" style="display:grid; grid-template-columns:1fr 1fr; gap:2vw; height:44vh;"></div>
    </div>

    <div id="mod6-container">
        <div class="video-wrapper">
            <video id="mod6-bg-video" autoplay muted loop playsinline>
                <source src="6.mp4" type="video/mp4">
            </video>
        </div>
        <div class="branding-panel">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/CNBC_logo.svg/1200px-CNBC_logo.svg.png" class="logo-img">
            <div class="clock-box" id="mod6Clock">00:00:00</div>
        </div>
        <div class="ticker-container">
            <div class="layer-indices"><div class="track-indices" id="yandexIndices">Yükleniyor...</div></div>
            <div class="layer-currencies" id="firebaseCurrencies"></div>
            <div class="layer-news">
                <div class="news-label">SON DAKİKA</div>
                <div class="news-track" id="newsTrack">Ekonomi verileri yükleniyor...</div>
            </div>
        </div>
    </div>

<script>
    // --- PWA Service Worker Kaydı ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            const swCode = `
                self.addEventListener('install', e => self.skipWaiting());
                self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
                self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));
            `;
            const blob = new Blob([swCode], {type: 'text/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        });
    }

    const firebaseConfig = {
      apiKey: "AIzaSyCfcppc4rGYxmAj7fTzmYMZgcyBO4s8bFI",
      databaseURL: "https://doviz-kurlari-35554-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "doviz-kurlari-35554",
      appId: "1:822410580056:web:40d02d7729d7cf72aafa2d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentMode = null;
    let firstLoadMod5 = true;

    function updateSystemTime() {
        const now = new Date();
        const hour = now.getHours();
        const timeStr = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
        const fullTimeStr = now.toLocaleTimeString('tr-TR');

        if(document.getElementById('mod1-time')) document.getElementById('mod1-time').innerText = timeStr;
        if(document.getElementById('mod6Clock')) document.getElementById('mod6Clock').innerText = fullTimeStr;

        const greeting = document.getElementById('greeting-text');
        if(greeting){
            if(hour >= 6 && hour < 12) greeting.innerText = "İyi Sabahlar";
            else if(hour >= 12 && hour < 18) greeting.innerText = "İyi Günler";
            else if(hour >= 18 && hour < 23) greeting.innerText = "İyi Akşamlar";
            else greeting.innerText = "İyi Geceler";
        }
    }
    setInterval(updateSystemTime, 1000);

    db.ref('terminal_data').on('value', snap => {
        const data = snap.val();
        if(!data) return;
        const mode = data.tv_settings.master2 ? data.tv_settings.screen2 : "standby";
        const currencies = data.currencies ? Object.values(data.currencies) : [];

        if(currentMode !== mode) {
            currentMode = mode;
            switchDisplay(mode);
        }
        if(mode === "5") updateMod5UI(currencies);
        if(mode === "6") renderCNBCData(currencies);
    });

    function switchDisplay(mode) {
        const containers = ['mod1-container', 'mod5-container', 'mod6-container', 'tv-image', 'tv-video'];
        containers.forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                if(id.includes('container')) el.style.display = 'none';
                else el.classList.remove('active');
            }
        });
        document.getElementById('tv-video').pause();
        document.getElementById('mod6-bg-video').pause();

        if(mode === "1") document.getElementById('mod1-container').style.display = 'flex';
        else if(mode === "5") { document.getElementById('mod5-container').style.display = 'block'; firstLoadMod5 = true; }
        else if(mode === "6") { 
            document.getElementById('mod6-container').style.display = 'block';
            document.getElementById('mod6-bg-video').play();
            updateLiveContent(); 
        }
        else loadMedia(mode);
    }

    function loadMedia(name) {
        const img = document.getElementById('tv-image');
        const vid = document.getElementById('tv-video');
        const testImg = new Image();
        testImg.src = name + ".jpg";
        testImg.onload = () => { img.src = name + ".jpg"; img.classList.add('active'); };
        testImg.onerror = () => {
            document.getElementById('video-source').src = name + ".mp4";
            vid.load(); vid.play().then(() => vid.classList.add('active'));
        };
    }

    function renderCNBCData(data) {
        const container = document.getElementById('firebaseCurrencies');
        container.innerHTML = data.slice(0, 7).map(item => {
            const isUp = Math.random() > 0.4;
            const iconClass = isUp ? 'fa-caret-up icon-up' : 'fa-caret-down icon-down';
            const currencyKey = item.name.substring(0,3).toUpperCase();
            return `
                <div class="currency-card card-${currencyKey}">
                    <div class="cur-row-wrapper">
                        <div class="cur-data-row"><div style="opacity:0.6;font-size:0.9rem">${item.name}</div><div class="cur-price">${item.buy.toFixed(4)} <i class="fas ${iconClass} status-icon"></i></div></div>
                        <div class="cur-data-row"><div style="opacity:0.6;font-size:0.9rem">${item.name}</div><div class="cur-price">${item.sell.toFixed(4)} <i class="fas ${iconClass} status-icon"></i></div></div>
                    </div>
                </div>`;
        }).join('');
    }

    async function updateLiveContent() {
        try {
            const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://www.aa.com.tr/tr/rss/default?cat=ekonomi`);
            const data = await res.json();
            if(data.status === 'ok') {
                const newsHtml = data.items.map(i => `<span class="news-item">${i.title.toUpperCase()} <span style="color:red">/</span></span>`).join('');
                document.getElementById('newsTrack').innerHTML = newsHtml + newsHtml;
                const indices = [{n:"NASDAQ",v:18120},{n:"DOW",v:39110},{n:"DAX",v:18450},{n:"S&P500",v:5240},{n:"NIKKEI",v:39770}];
                document.getElementById('yandexIndices').innerHTML = [...indices, ...indices].map(idx => `
                    <div class="index-item">${idx.n} <span>${idx.v.toLocaleString()}</span> <span class="idx-badge" style="background:var(--cnbc-green)">▲ %${(Math.random()).toFixed(2)}</span></div>
                `).join('');
            }
        } catch (e) { console.error("RSS Hatası"); }
    }

    (function(){
        const container = document.getElementById('snow-container');
        for(let i=0; i<30; i++) {
            let s = document.createElement('div'); s.className='snowflake';
            s.style.width = s.style.height = Math.random()*5+2+'px';
            s.style.left = Math.random()*100+'vw';
            s.style.animationDuration = Math.random()*3+2+'s';
            container.appendChild(s);
        }
    })();
</script>
</body>
</html>

