<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dynamic Dashboard Engine v3.6 - Elite Smart TV Edition</title>
    <meta name="theme-color" content="#000000">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;600;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #007bff;
            --success: #00c853;
            --danger: #ff5252;
            --gold: #FFD700;
            --gold-bright: #FFE44D;
            --fx-up: #00ff66;
            --fx-down: #ff3333;
            --eko-turkuaz: #0087b3;
            --eko-dark: #121516;
            --eko-gray: #2d2f30;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; color: #fff;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            font-size: 1.1vw;
            -webkit-font-smoothing: antialiased;
        }

        .engine-container { 
            height: 100%; width: 100%; display: flex; justify-content: center; align-items: center; 
            position: relative; z-index: 1; box-sizing: border-box;
            will-change: transform;
        }

        #bg-canvas, #gold-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        /* STANDBY MODU */
        .main-card { position: relative; z-index: 2; padding: 4rem; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(40px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 60px; text-align: center; max-width: 900px; width: 85%; box-shadow: 0 50px 100px rgba(0,0,0,0.9); }
        #clock { font-size: 12rem; font-weight: 200; letter-spacing: -8px; line-height: 1; color: #fff; margin: 0; }
        #full-date { font-size: 1.8rem; font-weight: 400; color: rgba(255,255,255,0.5); letter-spacing: 2px; margin-bottom: 30px; text-transform: uppercase; }
        #greeting { font-weight: 900; letter-spacing: 15px; color: var(--primary); margin-bottom: 20px; font-size: 2rem; text-transform: uppercase; }

        /* MOD 4 & 5 FX STYLE */
        .fx-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; padding: 2vh 2vw; gap: 2vh; box-sizing: border-box; }
        .fx-top-section { display: flex; gap: 1.5vw; height: 45vh; }
        .fx-card-big { flex: 1; background: linear-gradient(180deg, #111 0%, #050505 100%); border: 1px solid #333; border-radius: 2.5vh; padding: 3vh; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .fx-header { display: flex; align-items: center; gap: 1.5vw; height: 25%; }
        .fx-icon-big { height: 80%; aspect-ratio: 4/3; border-radius: 0.8vh; object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .fx-symbol-big { font-size: 4.8vw; font-weight: 900; letter-spacing: -2px; }
        .fx-price-area { display: flex; height: 65%; gap: 1.5vw; align-items: center; }
        .fx-sub-box { flex: 1; height: 100%; display: flex; flex-direction: column; justify-content: center; background: rgba(255,255,255,0.02); border-radius: 1.5vh; border: 1px solid rgba(255,255,255,0.05); }
        .fx-val-big { font-family: 'JetBrains Mono', monospace; font-size: 7.2vw; text-align: center; font-weight: 700; letter-spacing: -4px; }
        .fx-bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5vw; height: 43vh; }
        .fx-row { display: flex; align-items: center; justify-content: space-between; padding: 0 2vw; background: #0c0c0c; border: 1px solid #222; border-radius: 1.5vh; transition: all 0.5s ease; }
        .fx-icon-small { width: 4.5vw; height: 3.2vw; border-radius: 0.5vh; object-fit: cover; }
        .fx-symbol-small { font-size: 3vw; font-weight: 700; }
        .fx-val-small { font-family: 'JetBrains Mono', monospace; font-size: 4vw; flex: 1; text-align: right; }

        /* MOD 6 ELITE GOLD */
        .gold-panel-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; padding: 3vh 3vw; box-sizing: border-box; background: radial-gradient(circle at 50% 0%, #1a1500 0%, #000 70%); }
        .gold-header h1 { color: var(--gold); font-size: 3.8vw; font-weight: 900; letter-spacing: 2vw; text-transform: uppercase; margin: 0 0 4vh 0; text-align: center; filter: drop-shadow(0 0 20px rgba(255,215,0,0.3)); }
        .gold-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2vh 3vw; }
        .gold-row-item { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); padding: 2.5vh; border-radius: 2vh; border: 1px solid rgba(212, 175, 55, 0.2); transition: transform 0.3s ease; }
        .gold-product-name { font-size: 2vw; font-weight: 700; color: #fff; flex: 1; }
        .gold-buy-val, .gold-sell-val { font-family: 'JetBrains Mono', monospace; font-size: 3vw; font-weight: 800; }
        .gold-sell-val { color: var(--gold-bright); }

        /* FLASH EFFECTS */
        .flash-up { background-color: rgba(0, 255, 102, 0.15) !important; border-color: var(--fx-up) !important; transform: scale(1.02); }
        .flash-down { background-color: rgba(255, 51, 51, 0.15) !important; border-color: var(--fx-down) !important; transform: scale(1.02); }

        /* EKOTURK MOD 1 */
        .mod1-wrapper { width: 100%; height: 100%; position: relative; }
        .layer-headline { position: absolute; bottom: 134px; width: 100%; height: 60px; background: rgba(0,0,0,0.8); border-top: 2px solid var(--eko-turkuaz); overflow: hidden; }
        .headline-item { height: 60px; display: flex; align-items: center; padding-left: 40px; color: white; font-size: 1.8rem; font-weight: 600; }
        .layer-currency { position: absolute; bottom: 32px; width: calc(100% - 160px); height: 75px; background: #050505; display: flex; }
        .currency-box { flex: 1; border-right: 1px solid #222; padding: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .curr-name { font-size: 0.9rem; color: #aaa; font-weight: 800; margin-bottom: 5px; }
        .flip-container { height: 40px; overflow: hidden; position: relative; }
        .flip-inner { position: absolute; width: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .flip-row { height: 40px; display: flex; align-items: center; justify-content: space-between; font-size: 1.6rem; font-weight: 800; }
        .side-panel { position: absolute; right: 0; bottom: 32px; width: 160px; height: 137px; background: var(--eko-turkuaz); display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<canvas id="bg-canvas"></canvas>
<canvas id="gold-canvas"></canvas>
<div id="dashboard-engine" class="engine-container"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCfcppc4rGYxmAj7fTzmYMZgcyBO4s8bFI",
        databaseURL: "https://doviz-kurlari-35554-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "doviz-kurlari-35554",
        appId: "1:822410580056:web:40d02d7729d7cf72aafa2d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentConfig = { master: null, screen: null };
    let activeIntervals = [];
    let showSell = true;
    let animId = null;

    function clearEngine() {
        activeIntervals.forEach(clearInterval);
        activeIntervals = [];
        if(animId) cancelAnimationFrame(animId);
        document.getElementById('bg-canvas').style.display = "none";
        document.getElementById('gold-canvas').style.display = "none";
    }

    function getIcon(item) {
        const name = (item.name || "").toUpperCase();
        if (item.category === "altin" || name.includes("ALTIN") || name.includes("GOLD")) {
            return "https://cdn-icons-png.flaticon.com/512/2489/2489756.png"; 
        }
        const mapping = { 'USD': 'us', 'EUR': 'eu', 'GBP': 'gb', 'CHF': 'ch', 'CAD': 'ca', 'SAR': 'sa', 'JPY': 'jp', 'AUD': 'au' };
        const code = mapping[name] || 'un';
        return `https://flagcdn.com/w320/${code}.png`;
    }

    db.ref('terminal_data/tv_settings').on('value', snap => {
        const data = snap.val();
        if(!data) return;
        if(currentConfig.master !== data.master || currentConfig.screen !== data.screen) {
            currentConfig = { master: data.master, screen: data.screen };
            updateUI();
        }
    });

    function updateUI() {
        clearEngine();
        const container = document.getElementById('dashboard-engine');
        
        if (!currentConfig.master) renderStandby(container);
        else if (currentConfig.screen === "1") renderMod1(container);
        else if (currentConfig.screen === "4") renderMod4(container);
        else if (currentConfig.screen === "5") renderMod5(container);
        else if (currentConfig.screen === "6") renderMod6(container);
    }

    function renderStandby(container) {
        const canvas = document.getElementById('bg-canvas');
        canvas.style.display = "block";
        container.innerHTML = `<div class="main-card"><div id="greeting">HOŞGELDİNİZ</div><div id="clock">00:00</div><div id="full-date">---</div><div id="temp" style="font-size:2rem; font-weight:700;">...</div></div>`;
        
        initParticles(canvas);
        const clockTask = () => {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('full-date').textContent = now.toLocaleDateString('tr-TR', {day:'numeric', month:'long', year:'numeric', weekday:'long'});
        };
        clockTask();
        activeIntervals.push(setInterval(clockTask, 1000));
    }

    function renderMod4(container) {
        setupFXBase(container, "DÖVİZ PİYASASI", false);
        db.ref('terminal_data/currencies').on('value', snap => {
            const data = Object.values(snap.val() || {}).filter(i => i.category !== 'altin').slice(0, 8);
            updateFXGrid(data, false);
        });
    }

    function renderMod5(container) {
        setupFXBase(container, "ALTIN PİYASASI", true);
        db.ref('terminal_data/currencies').on('value', snap => {
            const data = Object.values(snap.val() || {}).filter(i => i.category === 'altin').sort((a,b) => (a.order||0)-(b.order||0)).slice(0, 10);
            updateFXGrid(data, true);
        });
    }

    function setupFXBase(container, title, isGold) {
        const canvas = document.getElementById('gold-canvas');
        canvas.style.display = "block";
        initGoldRain(canvas);
        container.innerHTML = `<div class="fx-wrapper"><div class="fx-top-section" id="fx-top"></div><div class="fx-bottom-grid" id="fx-bottom"></div></div>`;
    }

    function updateFXGrid(data, isGold) {
        const top = document.getElementById('fx-top');
        const bottom = document.getElementById('fx-bottom');
        if(!top || !bottom) return;

        top.innerHTML = ''; bottom.innerHTML = '';
        data.forEach((c, i) => {
            const buy = parseFloat(c.buy).toLocaleString('tr-TR', {minimumFractionDigits: isGold ? 0 : 3});
            const sell = parseFloat(c.sell).toLocaleString('tr-TR', {minimumFractionDigits: isGold ? 0 : 3});
            const icon = getIcon(c);

            if(i < 2) {
                top.innerHTML += `<div class="fx-card-big" id="card-${c.id}"><div class="fx-header"><img src="${icon}" class="fx-icon-big"><span class="fx-symbol-big">${c.name}</span></div><div class="fx-price-area"><div class="fx-sub-box"><span style="color:#666; text-align:center; font-weight:800;">ALIŞ</span><span class="fx-val-big" style="color:var(--fx-down)">${buy}</span></div><div class="fx-sub-box"><span style="color:#666; text-align:center; font-weight:800;">SATIŞ</span><span class="fx-val-big" style="color:var(--fx-up)">${sell}</span></div></div></div>`;
            } else {
                bottom.innerHTML += `<div class="fx-row" id="card-${c.id}"><div style="display:flex; align-items:center; gap:1vw; width:30%;"><img src="${icon}" class="fx-icon-small"><span class="fx-symbol-small">${c.name}</span></div><div style="display:flex; width:65%; justify-content:space-between;"><span class="fx-val-small" style="color:var(--fx-down)">${buy}</span><span class="fx-val-small" style="color:var(--fx-up)">${sell}</span></div></div>`;
            }
        });
    }

    function renderMod6(container) {
        container.innerHTML = `<div class="gold-panel-wrapper"><div class="gold-header"><h1>CANLI ALTIN PİYASASI</h1></div><div class="gold-container" id="gold-list"></div></div>`;
        db.ref('terminal_data/currencies').on('value', snap => {
            const data = Object.values(snap.val() || {}).filter(i => i.category === 'altin').sort((a,b) => (a.order||0)-(b.order||0));
            const list = document.getElementById('gold-list');
            if(list) {
                list.innerHTML = data.map(item => `
                    <div class="gold-row-item">
                        <div class="gold-product-name">${item.name}</div>
                        <div style="display:flex; gap:3vw; align-items:center;">
                            <div class="gold-buy-val">${Math.floor(item.buy).toLocaleString('tr-TR')}</div>
                            <div style="color:var(--fx-up); font-size:1.5vw;">▲</div>
                            <div class="gold-sell-val">${Math.floor(item.sell).toLocaleString('tr-TR')}</div>
                        </div>
                    </div>`).join('');
            }
        });
    }

    function renderMod1(container) {
        container.innerHTML = `<div class="mod1-wrapper">
            <div class="side-panel"><div style="font-weight:900; font-size:1.5rem;">EKOTÜRK</div><div id="m1-time" style="font-weight:700;"></div></div>
            <div class="layer-headline" id="m1-news"></div>
            <div class="layer-currency" id="m1-cur"></div>
        </div>`;
        
        db.ref('terminal_data/currencies').on('value', snap => {
            const data = Object.values(snap.val() || {}).slice(0, 6);
            const curBox = document.getElementById('m1-cur');
            if(curBox) {
                curBox.innerHTML = data.map(c => `
                    <div class="currency-box">
                        <div class="curr-name">${c.name}</div>
                        <div class="flip-container"><div class="flip-inner" id="flip-${c.id}">
                            <div class="flip-row"><span>${parseFloat(c.buy).toFixed(3)}</span><span style="color:var(--fx-up); font-size:1rem;">▲</span></div>
                            <div class="flip-row"><span>${parseFloat(c.sell).toFixed(3)}</span><span style="color:var(--fx-up); font-size:1rem;">▲</span></div>
                        </div></div>
                    </div>`).join('');
            }
        });

        activeIntervals.push(setInterval(() => {
            showSell = !showSell;
            document.querySelectorAll('.flip-inner').forEach(el => {
                el.style.transform = showSell ? 'translateY(-40px)' : 'translateY(0px)';
            });
        }, 4000));
    }

    function initParticles(canvas) {
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let pts = Array.from({length: 50}, () => ({
            x: Math.random()*canvas.width, y: Math.random()*canvas.height,
            vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5
        }));
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            pts.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x<0 || p.x>canvas.width) p.vx*=-1;
                if(p.y<0 || p.y>canvas.height) p.vy*=-1;
                ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
                ctx.fillStyle = "rgba(0,123,255,0.5)"; ctx.fill();
            });
            animId = requestAnimationFrame(draw);
        }
        draw();
    }

    function initGoldRain(canvas) {
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let drops = Array.from({length: 60}, () => ({
            x: Math.random()*canvas.width, y: Math.random()*canvas.height,
            s: Math.random()*2+1, sp: Math.random()*1+0.5
        }));
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "rgba(255, 215, 0, 0.2)";
            drops.forEach(d => {
                d.y += d.sp; if(d.y > canvas.height) d.y = -10;
                ctx.beginPath(); ctx.arc(d.x, d.y, d.s, 0, Math.PI*2); ctx.fill();
            });
            animId = requestAnimationFrame(draw);
        }
        draw();
    }

    window.addEventListener('resize', () => {
        const c1 = document.getElementById('bg-canvas');
        const c2 = document.getElementById('gold-canvas');
        if(c1) { c1.width = window.innerWidth; c1.height = window.innerHeight; }
        if(c2) { c2.width = window.innerWidth; c2.height = window.innerHeight; }
    });
</script>

</body>
</html>
