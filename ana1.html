<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enterprise Currency Terminal v3.5 Pro+</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Mevcut Stillerinize Ek Olarak */
        :root {
            --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --primary: #007bff;
            --secondary: #65676b; --success: #00c853; --danger: #ff5252; --border: #e4e6eb;
            --warning: #f39c12;
            --header-gradient: linear-gradient(135deg, #0062cc 0%, #004a99 100%);
            --overlay: rgba(0,0,0,0.5);
        }
        [data-theme="dark"] {
            --bg: #0f1011; --card: #1c1e21; --text: #e4e6eb; --secondary: #b0b3b8;
            --border: #333537; --header-gradient: linear-gradient(135deg, #161719 0%, #25272a 100%);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; justify-content: center; transition: 0.3s; }
        .container { width: 100%; max-width: 500px; padding: 0 12px 100px 12px; }
        
        /* FÄ°LTRELEME BUTONLARI STÄ°LÄ° */
        .filter-bar { display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; padding: 4px 0; scrollbar-width: none; }
        .filter-bar::-webkit-scrollbar { display: none; }
        .filter-btn { padding: 6px 14px; border-radius: 20px; border: 1px solid var(--border); background: var(--card); color: var(--secondary); font-size: 11px; font-weight: bold; white-space: nowrap; cursor: pointer; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .header { background: var(--header-gradient); padding: 12px 18px; border-radius: 0 0 20px 20px; margin: 0 -12px 15px -12px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.15); position: sticky; top:0; z-index:1001; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .brand-section { display: flex; align-items: center; gap: 10px; }
        .chameleon-icon { font-size: 24px; animation: bounce 2s infinite ease-in-out; display: inline-block; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-5px) rotate(10deg); } }
        
        .compact-info-row { display: flex; align-items: center; gap: 8px; font-size: 11px; background: rgba(0,0,0,0.2); padding: 4px 10px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .header-stats { display: flex; align-items: center; gap: 6px; font-weight: 600; color: #00ff88; }
        .countdown-box { font-family: monospace; font-weight: bold; color: white; opacity: 0.8; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 8px; }

        .toolbar-btns { display: flex; gap: 6px; }
        .btn-round { width: 34px; height: 34px; border-radius: 10px; border: none; background: rgba(255,255,255,0.15); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; font-size: 14px; }
        .btn-round.active-green { background: var(--success); box-shadow: 0 0 10px var(--success); }
        
        #tv-settings-container { display: none; margin-bottom: 15px; }
        #settings-panel, #tv-panel { background: var(--card); border-radius: 18px; padding: 18px; border: 1px solid var(--border); box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: 5px; }
        .input-box { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); margin-bottom: 10px; font-size: 13px; }
        .label-style { font-size: 10px; font-weight: 800; color: var(--secondary); margin-bottom: 4px; display: block; text-transform: uppercase; }

        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(22px); }

        .currency-card { background: var(--card); border-radius: 15px; padding: 14px; margin-bottom: 10px; display: grid; grid-template-columns: auto auto 1fr auto auto; align-items: center; gap: 12px; border: 1px solid var(--border); cursor: pointer; transition: transform 0.1s; position: relative; }
        .drag-handle { color: var(--secondary); cursor: grab; padding: 5px; opacity: 0.5; }
        .flag-box { position: relative; width: 42px; height: 42px; }
        .flag-anim { width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; display: flex; align-items: center; justify-content: center; font-size: 20px; background: var(--bg); }
        .price-col { text-align: right; min-width: 85px; }
        .price-val { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 800; color: var(--primary); }
        
        .cc-price-box { margin-top: 4px; padding: 2px 4px; background: rgba(243, 156, 18, 0.1); border-radius: 4px; border: 1px solid rgba(243, 156, 18, 0.2); }
        .cc-price-val { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 800; color: var(--warning); }
        .cc-label { font-size: 8px; font-weight: bold; color: var(--warning); display: block; text-transform: uppercase; }

        .internal-logs { background: #111; border-radius: 10px; padding: 10px; margin-top: 15px; max-height: 200px; overflow-y: auto; border: 1px solid #333; font-family: 'monospace'; }
        .log-entry { display: flex; align-items: flex-start; gap: 8px; font-size: 10px; padding: 4px 0; border-bottom: 1px solid #222; }
        .log-time { color: #888; white-space: nowrap; }
        .log-tag { padding: 2px 4px; border-radius: 4px; font-weight: bold; font-size: 8px; text-transform: uppercase; }
        .tag-info { background: #007bff; color: white; }
        .tag-update { background: #00c853; color: white; }
        .tag-error { background: #ff5252; color: white; }
        .tag-warn { background: #ffa000; color: white; }
        .log-msg { color: #eee; line-height: 1.3; }

        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--overlay); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: var(--card); width: 100%; max-width: 400px; border-radius: 20px; padding: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); padding: 8px 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 1000; height: 60px; }
        .lock-indicator { position: absolute; top: 5px; left: 5px; font-size: 10px; color: var(--secondary); }
        .sortable-ghost { opacity: 0.3; background: var(--primary) !important; }
        
        .bottom-tv-control { display: flex; align-items: center; gap: 10px; background: var(--bg); padding: 5px 12px; border-radius: 12px; border: 1px solid var(--border); }
        .tv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .tv-card-inner { background: var(--bg); padding: 10px; border-radius: 12px; border: 1px solid var(--border); }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <header class="header">
        <div class="header-top">
            <div class="brand-section">
                <span class="chameleon-icon">ðŸ¦Ž</span>
                <div class="compact-info-row">
                    <div class="header-stats"><i class="fas fa-layer-group"></i> <span id="stat-count">0</span></div>
                    <div class="header-stats" style="color:#00e5ff; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 8px;"><i class="fas fa-clock"></i> <span id="stat-sync">--:--</span></div>
                    <div class="countdown-box" id="timer-box">--</div>
                </div>
            </div>
            <div class="toolbar-btns">
                <button class="btn-round" onclick="toggleAuto()" id="auto-btn"><i class="fas fa-robot"></i></button>
                <button class="btn-round" onclick="toggleSettingsArea()" id="tv-btn"><i class="fas fa-tv"></i></button>
                <button class="btn-round" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
            </div>
        </div>
    </header>

    <div class="filter-bar" id="main-filter-bar">
        <button class="filter-btn active" onclick="filterList('all', this)">HEPSÄ°</button>
        <button class="filter-btn" onclick="filterList('doviz', this)">DÃ–VÄ°Z</button>
        <button class="filter-btn" onclick="filterList('altin', this)">ALTIN</button>
        <button class="filter-btn" onclick="filterList('kripto', this)">KRÄ°PTO</button>
    </div>

    <div id="tv-settings-container">
        <div id="settings-panel">
            <div style="display:flex; gap:10px; margin-bottom:15px">
                <button class="btn-round" style="flex:1; background:#6c757d; border-radius:8px; font-size:10px;" onclick="exportData()"><i class="fas fa-download"></i> YEDEK AL</button>
                <button class="btn-round" style="flex:1; background:#6c757d; border-radius:8px; font-size:10px;" onclick="importData()"><i class="fas fa-upload"></i> YEDEK YÃœKLE</button>
            </div>

            <div class="internal-logs">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px">
                    <span class="label-style" style="color:white; margin:0">SÄ°STEM LOGLARI</span>
                    <span onclick="clearLogs()" style="color:var(--danger); font-size:9px; cursor:pointer; font-weight:bold">TEMÄ°ZLE</span>
                </div>
                <div id="log-list"></div>
            </div>
        </div>
    </div>

    <div id="currency-list"></div>
</div>

<div class="bottom-nav">
    <div style="display:flex; align-items:center; gap:8px; overflow: hidden; white-space: nowrap; flex: 1; margin-right: 10px;">
        <div id="status-dot" style="width:10px; height:10px; background:var(--success); border-radius:50%; flex-shrink: 0;"></div>
        <small id="footer-status" style="font-size:11px; font-weight:bold; overflow: hidden; text-overflow: ellipsis;">Sistem HazÄ±r</small>
    </div>
    </div>

<script>
    // ... (Firebase Config ve Init AynÄ±) ...

    let currentFilter = 'all';

    // EK FONKSÄ°YONLAR (FAZLALIKLAR)
    
    function filterList(cat, btn) {
        currentFilter = cat;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render();
    }

    function clearLogs() {
        document.getElementById('log-list').innerHTML = '';
        addLog("Log geÃ§miÅŸi temizlendi.", "INFO");
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(currencies));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "terminal_backup_" + new Date().toLocaleDateString() + ".json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.readAsText(file, 'UTF-8');
            reader.onload = readerEvent => {
                try {
                    const content = JSON.parse(readerEvent.target.result);
                    if(confirm("TÃ¼m veriler yedekle deÄŸiÅŸtirilsin mi?")) {
                        currencies = content;
                        saveToFirebase();
                        addLog("Yedek baÅŸarÄ±yla yÃ¼klendi.", "UPDATE");
                    }
                } catch(err) {
                    addLog("GeÃ§ersiz yedek dosyasÄ±!", "ERROR");
                }
            }
        }
        input.click();
    }

    // MODÄ°FÄ°YE EDÄ°LMÄ°Åž RENDER (Filtreleme Destekli)
    function render() {
        const list = document.getElementById('currency-list');
        list.innerHTML = '';
        
        const filtered = currencies.filter(c => currentFilter === 'all' || c.category === currentFilter);
        
        filtered.forEach(c => {
            // ... (Mevcut Render MantÄ±ÄŸÄ±) ...
            // BurasÄ± orijinal render kodunuzun aynÄ±sÄ± olacak, sadece 'currencies' yerine 'filtered' dÃ¶necek.
        });
        document.getElementById('stat-count').innerText = currencies.length;
    }

    // ... (DiÄŸer tÃ¼m orijinal fonksiyonlar: toggleAuto, fetchMarketData, processCSVData vb. buraya gelecek) ...

</script>
</body>
</html>
